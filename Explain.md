# AI 학습 도우미 플랫폼 전체 아키텍처 문서

## 프로젝트 개요

이 프로젝트는 교육용 AI 챗봇 플랫폼으로, 학생들이 다양한 학습 활동(논증, 토론, 실험)을 수행하고 교사가 이를 관리할 수 있는 종합적인 교육 시스템입니다.

## 기술 스택

### 프론트엔드
- **React 18.3.1** - 메인 UI 프레임워크
- **TypeScript** - 타입 안전성 보장
- **Vite** - 빌드 도구 및 개발 서버
- **React Router DOM 6.26.2** - 클라이언트 사이드 라우팅
- **TanStack React Query 5.56.2** - 서버 상태 관리

### UI 컴포넌트 시스템
- **Radix UI** - 헤드리스 UI 컴포넌트 라이브러리
- **Tailwind CSS 3.4.11** - 유틸리티 퍼스트 CSS 프레임워크
- **shadcn/ui** - 재사용 가능한 컴포넌트 시스템
- **Lucide React** - 아이콘 라이브러리
- **Class Variance Authority** - 조건부 스타일링

### 백엔드 & 데이터베이스
- **Supabase** - Backend as a Service
  - PostgreSQL 데이터베이스
  - 실시간 구독
  - 인증 시스템
  - Edge Functions
  - Vector 임베딩 지원

### AI 통합
- **OpenAI API** - GPT-4 기반 AI 챗봇
- **Anthropic Claude** - 대체 AI 모델 지원
- **RAG (Retrieval-Augmented Generation)** - 문서 기반 맥락 제공

## 아키텍처 구조

### 1. 애플리케이션 구조
```
src/
├── components/          # 재사용 가능한 컴포넌트
│   ├── admin/          # 관리자 전용 컴포넌트
│   ├── student/        # 학생 전용 컴포넌트
│   ├── auth/           # 인증 관련 컴포넌트
│   └── ui/             # 기본 UI 컴포넌트 (shadcn/ui)
├── hooks/              # 커스텀 React 훅
├── pages/              # 페이지 컴포넌트
├── types/              # TypeScript 타입 정의
├── utils/              # 유틸리티 함수
└── integrations/       # 외부 서비스 통합
    └── supabase/       # Supabase 클라이언트 및 타입
```

### 2. 라우팅 구조
- `/auth` - 로그인 페이지
- `/admin` - 관리자 대시보드 (역할 기반 접근 제어)
- `/student` - 학생 대시보드 (역할 기반 접근 제어)
- `*` - 404 페이지

### 3. 역할 기반 접근 제어 (RBAC)
- **관리자 (admin)**: 전체 시스템 관리, 학생 관리, 활동 생성/수정, AI 설정
- **학생 (student)**: 학습 활동 참여, AI 챗봇 상호작용

## 데이터베이스 구조

### 핵심 테이블

#### 1. 사용자 관리
- `user_roles`: 사용자 역할 정의 (admin/student)
- `students`: 학생 정보 (학번, 이름, 반, 조, 모국어)

#### 2. 활동 관리
- `activities`: 학습 활동 정보 (제목, 타입, 내용, 파일)
- `activity_modules`: 활동의 모듈 구조
- `checklist_items`: 체크리스트 단계별 항목
- `student_checklist_progress`: 학생별 체크리스트 진행 상황

#### 3. AI 및 채팅
- `chat_logs`: 학생-AI 대화 기록
- `admin_settings`: 전역 AI 설정
- `class_prompt_settings`: 반별 AI 설정
- `prompt_templates`: AI 프롬프트 템플릿
- `question_frequency`: 질문 빈도 추적

#### 4. 논증 활동
- `argumentation_responses`: 학생 논증 작성 내용
- `peer_evaluations`: 동료평가 데이터
- `peer_evaluation_phases`: 평가 단계 관리
- `evaluation_reflections`: 평가 성찰 기록

#### 5. RAG 시스템
- `document_chunks`: 문서 청크 및 임베딩
- Vector 검색을 위한 PostgreSQL pgvector 확장

#### 6. 세션 관리
- `student_sessions`: 학생 온라인 상태 추적
- `student_work_drafts`: 작업 임시 저장

### RLS (Row Level Security) 정책
- 모든 테이블에 적절한 RLS 정책 적용
- 역할 기반 데이터 접근 제어
- 학생은 자신의 데이터만 접근 가능
- 관리자는 전체 데이터 접근 가능

## 주요 기능

### 1. 관리자 기능
#### 학생 관리
- CSV 파일을 통한 대량 학생 등록
- 학생 정보 개별 추가/수정/삭제
- 반별 학생 조회 및 관리

#### 활동 관리
- 다양한 활동 유형 생성 (논증, 토론, 실험)
- 모듈식 체크리스트 구성
- PDF 파일 업로드 및 RAG 처리
- 활동별 세부 설정

#### AI 설정
- OpenAI/Anthropic API 키 관리
- 전역 및 반별 AI 모델 설정
- 시스템 프롬프트 커스터마이징
- RAG 기능 활성화/비활성화

#### 실시간 모니터링
- 학생 온라인 상태 실시간 추적
- 채팅 로그 모니터링
- 활동 참여 현황 대시보드

#### 수업 관리
- 반별 체크리스트 진행상황 리셋
- 동료평가 배정 및 관리
- 학생 응답 조회 및 분석

#### 학습 기록
- 학생별 활동 참여 이력
- 채팅 로그 분석
- 성과 데이터 시각화

### 2. 학생 기능
#### 활동 선택 및 참여
- 이용 가능한 활동 목록 조회
- 활동별 진행 상황 표시
- 체크리스트 기반 단계별 학습

#### AI 챗봇 상호작용
- 실시간 AI 채팅
- 파일 업로드 지원
- 다국어 지원 (모국어 기반 응답)
- RAG 기반 맥락적 답변

#### 논증 활동
- **1단계**: 논증 작성 및 제출
- **2단계**: AI 기반 동료평가 수행
- **3단계**: 평가 결과 확인 및 성찰

#### 세션 관리
- 자동 세션 추적
- 오프라인 상태에서 임시 저장
- 온라인 복구 시 자동 동기화

## Edge Functions

### 1. ai-chat
- AI 모델과의 실시간 채팅 처리
- 다중 AI 제공업체 지원 (OpenAI, Anthropic)
- 다국어 프롬프트 처리
- RAG 기반 맥락 제공
- 채팅 로그 및 질문 빈도 추적

### 2. process-pdf
- PDF 파일 텍스트 추출
- 문서 청킹 및 임베딩 생성
- Vector 데이터베이스 저장

### 3. rag-search
- 벡터 유사도 검색
- 키워드 기반 폴백 검색
- 관련 문서 청크 반환

### 4. verify-admin
- 관리자 권한 검증
- API 요청 인증

## 데이터 흐름

### 1. 학생 학습 플로우
```
로그인 → 활동 선택 → 체크리스트 진행 → AI 챗봇 상호작용 → 과제 제출 → 동료평가 → 성찰
```

### 2. AI 응답 생성 플로우
```
사용자 질문 → RAG 검색 (선택적) → AI 모델 호출 → 다국어 처리 → 응답 반환 → 로그 저장
```

### 3. 동료평가 플로우
```
논증 제출 → 관리자 평가 배정 → AI 가이드 평가 → 평가 완료 → 결과 확인 → 성찰 작성
```

## 보안 및 권한

### 1. 인증 및 인가
- Supabase Auth 기반 사용자 인증
- 역할 기반 접근 제어 (RBAC)
- Row Level Security (RLS) 정책

### 2. API 보안
- Edge Functions를 통한 안전한 AI API 호출
- 환경 변수를 통한 API 키 관리
- CORS 정책 적용

### 3. 데이터 보호
- 학생 개인정보 암호화
- 채팅 로그 접근 제한
- 임시 저장 데이터 자동 정리

## 성능 최적화

### 1. 프론트엔드
- React Query를 통한 효율적 데이터 캐싱
- 가상화를 통한 대용량 메시지 목록 렌더링
- 코드 분할 및 지연 로딩

### 2. 백엔드
- Vector 인덱스를 통한 빠른 유사도 검색
- 데이터베이스 쿼리 최적화
- 실시간 구독을 통한 효율적 상태 동기화

### 3. AI 통합
- 응답 캐싱을 통한 중복 요청 방지
- 질문 빈도 추적으로 인기 질문 식별
- RAG 시스템을 통한 정확한 맥락 제공

## 확장성 고려사항

### 1. 모듈형 아키텍처
- 활동 유형별 독립적인 컴포넌트 구조
- 플러그인 형태의 AI 제공업체 지원
- 재사용 가능한 UI 컴포넌트 시스템

### 2. 데이터베이스 설계
- 정규화된 테이블 구조
- 확장 가능한 JSON 필드 활용
- 효율적인 인덱싱 전략

### 3. API 설계
- RESTful API 패턴
- 페이지네이션 지원
- 에러 처리 표준화

## 모니터링 및 로깅

### 1. 사용자 활동 추적
- 실시간 온라인 상태 모니터링
- 학습 진행 상황 추적
- 채팅 상호작용 로깅

### 2. 시스템 메트릭
- AI API 사용량 추적
- 응답 시간 모니터링
- 에러 발생 빈도 분석

### 3. 교육적 분석
- 질문 패턴 분석
- 학습 효과 측정
- 동료평가 품질 평가

이 문서는 AI 학습 도우미 플랫폼의 전체적인 아키텍처와 구현 내용을 포괄적으로 설명하며, 시스템의 확장과 유지보수를 위한 기술적 가이드라인을 제공합니다.